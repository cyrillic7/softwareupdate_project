# 增强设置功能说明

## 功能概述

QtProject.exe软件的应用设置页面已完善，新增了日志管理、路径配置和自动化功能，提供更全面的应用程序配置选项。

## 应用设置详解

### 📂 常规设置组

#### 界面布局
```
┌─────────────────────────────────────────────────────────────────┐
│ 常规设置                                                        │
├─────────────────────────────────────────────────────────────────┤
│ ☑ 自动保存设置                                                  │
│ ☐ 启动时显示日志                                                │
│ 默认文件路径: [C:\Users\...\Documents    ] [浏览]               │
│ 日志存储路径: [E:\winpro\680update_software] [浏览] [打开]      │
│ ☐ 自动清理过期日志              保留天数: [30 天    ▼]         │
└─────────────────────────────────────────────────────────────────┘
```

## 新增功能特性

### 📁 日志存储路径配置

**默认设置**
- **默认路径**：应用程序所在目录
- **获取方式**：`QApplication::applicationDirPath()`
- **示例路径**：`E:\winpro\680update_software`

**自定义配置**
- **浏览按钮**：紫色主题，点击选择自定义目录
- **路径验证**：自动检查目录是否存在
- **自动创建**：不存在时提示创建目录

**一键打开功能**
- **打开按钮**：绿色主题，直接在文件管理器中打开
- **智能处理**：目录不存在时自动创建
- **系统集成**：使用系统默认文件管理器

### 🧹 自动清理日志功能

**清理机制**
- **触发条件**：勾选"自动清理过期日志"复选框
- **保留天数**：1-365天可调，默认30天
- **清理目标**：超过指定天数的日志文件
- **安全保护**：只清理日志文件，不影响其他文件

**使用方式**
1. 勾选"自动清理过期日志"
2. 设置日志保留天数
3. 程序会在适当时机自动清理过期日志

### ⚙️ 智能控件联动

**条件启用**
- **保留天数**：仅在启用自动清理时可编辑
- **按钮状态**：根据路径有效性自动调整
- **实时反馈**：输入验证和错误提示

## 按钮配色方案

### 🎨 视觉设计
```css
浏览日志路径  - 紫色 (#8e44ad) 
打开日志目录  - 绿色 (#27ae60)
浏览文件路径  - 橙色 (#f39c12)
确定按钮     - 蓝色 (#3498db)
取消按钮     - 灰色 (#95a5a6)
恢复默认     - 红色 (#e74c3c)
```

### 交互效果
- **悬停效果**：颜色加深，提供视觉反馈
- **按下效果**：进一步加深，确认点击动作
- **禁用状态**：灰色显示，表示不可操作

## 功能使用场景

### 🏠 默认使用（推荐）
```
日志存储路径: E:\winpro\680update_software
自动清理:    ☐ 不启用
保留天数:    30天（不生效）
```
- **适用于**：大多数用户
- **优点**：简单直接，日志与程序在同一目录
- **管理**：手动管理日志文件

### 🔧 自定义路径
```
日志存储路径: D:\Logs\680update_software
自动清理:    ☐ 不启用  
保留天数:    30天（不生效）
```
- **适用于**：需要统一管理日志的用户
- **优点**：日志集中存储，便于备份和管理
- **注意**：确保目录有写入权限

### 🧹 自动维护（高级用户）
```
日志存储路径: E:\winpro\680update_software
自动清理:    ☑ 启用
保留天数:    7天
```
- **适用于**：频繁使用的环境
- **优点**：自动清理，防止日志占用过多空间
- **风险**：过期日志会被自动删除

### 🏢 企业环境
```
日志存储路径: \\server\logs\680update_software
自动清理:    ☑ 启用
保留天数:    90天
```
- **适用于**：企业网络环境
- **优点**：集中存储，便于监控和审计
- **要求**：网络路径需要有效的访问权限

## 操作指南

### 配置日志路径
1. 打开设置页面 (`Ctrl+O`)
2. 切换到"应用设置"标签页
3. 在"日志存储路径"框中查看当前路径
4. 点击"浏览"选择新路径，或点击"打开"查看当前路径

### 启用自动清理
1. 勾选"自动清理过期日志"复选框
2. "保留天数"输入框自动启用
3. 设置合适的保留天数（建议7-90天）
4. 点击"确定"保存设置

### 快速访问日志
1. 在应用设置页面
2. 点击"打开"按钮
3. 系统文件管理器自动打开日志目录
4. 可查看或管理日志文件

## 技术实现细节

### 路径处理
```cpp
// 获取默认应用程序目录
QString appDir = QApplication::applicationDirPath();

// 目录存在性检查
QDir dir(logPath);
if (!dir.exists()) {
    dir.mkpath(logPath);  // 自动创建
}
```

### 文件管理器集成
```cpp
// 打开系统文件管理器
QDesktopServices::openUrl(QUrl::fromLocalFile(logPath));
```

### 控件联动
```cpp
// 自动清理复选框与保留天数联动
connect(autoCleanLogCheckBox, &QCheckBox::toggled, 
        retentionDaysSpinBox, &QSpinBox::setEnabled);
```

## 设置保存格式

### JSON配置示例
```json
{
    "serverIP": "172.16.10.161",
    "serverPort": 22,
    "username": "root",
    "remoteDir": "/media/sata/ue_data/",
    "defaultLocalPath": "C:\\Users\\Username\\Documents",
    "logStoragePath": "E:\\winpro\\680update_software",
    "autoCleanLog": false,
    "logRetentionDays": 30,
    "autoSaveSettings": true,
    "showLogByDefault": false,
    "maxLogLines": 1000,
    "saveTime": "2025-01-15T10:30:00"
}
```

### 配置文件位置
- **文件名**：`upload_settings.json`
- **位置**：程序所在目录
- **编码**：UTF-8
- **格式**：标准JSON格式

## 错误处理

### 常见问题

#### 1. 无法创建日志目录
**现象**：点击"打开"按钮提示"无法创建日志目录"
**原因**：
- 路径包含非法字符
- 磁盘空间不足
- 权限不足

**解决方案**：
- 检查路径格式是否正确
- 确保有足够的磁盘空间
- 以管理员权限运行程序

#### 2. 日志路径无效
**现象**：设置保存后日志功能异常
**原因**：
- 网络路径不可访问
- 路径被其他程序占用
- 路径格式错误

**解决方案**：
- 使用本地路径替代网络路径
- 重启程序释放文件占用
- 检查路径格式和权限

#### 3. 自动清理不生效
**现象**：启用自动清理但过期日志未被删除
**原因**：
- 日志文件被其他程序占用
- 权限不足无法删除
- 清理逻辑尚未实现

**解决方案**：
- 关闭可能占用日志的程序
- 确保程序有删除权限
- 手动清理过期日志

## 最佳实践建议

### 💡 路径选择
1. **本地路径优先**：避免网络路径可能的不稳定
2. **独立目录**：为日志创建专门的子目录
3. **权限确认**：确保程序对目录有读写权限

### 🧹 清理策略
1. **合理保留期**：根据使用频率设置（日常7-30天，重要30-90天）
2. **定期检查**：即使启用自动清理也要定期手动检查
3. **重要备份**：关键日志应定期备份到安全位置

### 🔧 维护建议
1. **定期更新**：及时更新到最新版本
2. **配置备份**：备份settings.json配置文件
3. **性能监控**：关注日志对程序性能的影响

## 版本信息

- **功能版本**：v1.3.0
- **更新内容**：增强应用设置页面
- **新增功能**：日志路径配置、自动清理、目录管理
- **编译脚本**：build_enhanced_settings.bat

---

**提示**：增强的应用设置功能让日志管理更加智能和便捷，用户可以根据实际需求灵活配置日志存储和清理策略，提升软件的易用性和维护性。 