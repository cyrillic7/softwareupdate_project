# 680图像机软件 - 完整设置功能说明

## 概述
本版本实现了完整的应用程序设置管理功能，包括自动保存、启动显示控制、智能路径管理和日志清理等高级特性。

## 功能详情

### 1. 连接设置
- **远程目录配置**：设置文件上传的目标目录
- **连接超时设置**：5-120秒可调，优化网络适应性
- **目录测试功能**：验证远程目录的可访问性

### 2. 应用程序设置

#### 2.1 自动保存设置
- **功能**：自动保存用户的配置选择
- **效果**：
  - 启用时：所有设置更改都会自动保存到系统配置
  - 文件选择时会自动更新默认路径
  - 连接设置也会被自动保存
- **存储位置**：使用QSettings保存到系统注册表/配置文件

#### 2.2 启动时显示日志
- **功能**：控制程序启动时是否显示日志窗口
- **效果**：
  - 启用：程序启动时日志窗口可见
  - 禁用：程序启动时日志窗口隐藏，可手动打开
- **适用场景**：根据用户使用习惯定制界面

#### 2.3 默认文件路径
- **功能**：设置文件选择对话框的起始目录
- **默认值**：应用程序所在目录
- **智能更新**：当启用自动保存时，选择文件后自动更新为该文件所在目录
- **浏览按钮**：可手动选择常用的文件目录

#### 2.4 日志存储路径
- **功能**：指定日志文件的保存位置
- **默认值**：应用程序所在目录
- **浏览功能**：支持选择自定义存储位置
- **打开按钮**：快速打开日志存储目录查看文件

#### 2.5 自动清理日志
- **功能**：自动删除过期的日志文件
- **保留天数**：1-365天可调，默认30天
- **清理时机**：
  - 程序启动时（如果启用）
  - 设置更改后立即清理
- **清理范围**：删除指定天数前的.log和.txt文件
- **反馈信息**：显示清理结果和释放的存储空间

### 3. 高级设置
- **最大日志行数**：100-10000行可调，控制内存使用
- **严格主机密钥检查**：增强安全性的SSH连接选项
- **保存密码选项**：便捷性与安全性的平衡

## 技术实现

### 设置存储
```cpp
// 使用QSettings管理应用设置
QSettings settings("QtProject", "680UpdateSoftware");
settings.beginGroup("Application");
settings.setValue("autoSave", autoSaveSettings);
settings.setValue("showLogByDefault", showLogByDefault);
// ...更多设置项
```

### 日志清理算法
```cpp
// 基于文件修改时间的智能清理
QDateTime expireDate = QDateTime::currentDateTime().addDays(-logRetentionDays);
foreach (const QFileInfo &fileInfo, logFiles) {
    if (fileInfo.lastModified() < expireDate) {
        // 清理过期文件
    }
}
```

### 智能路径管理
```cpp
// 文件选择时自动更新默认路径
if (autoSaveSettings) {
    QString newDefaultPath = QFileInfo(fileName).absolutePath();
    if (newDefaultPath != defaultLocalPath) {
        defaultLocalPath = newDefaultPath;
        saveApplicationSettings();
    }
}
```

## 使用指南

### 1. 首次使用
1. 运行程序，所有设置使用默认值
2. 打开设置对话框（菜单 -> 设置，或Ctrl+O）
3. 根据需要调整各项设置
4. 建议启用"自动保存设置"以获得最佳体验

### 2. 设置调优建议
- **频繁使用者**：启用自动保存和启动显示日志
- **偶尔使用者**：禁用启动显示日志，减少界面干扰
- **存储空间有限**：启用自动清理日志，设置较短的保留期
- **网络较慢**：增加连接超时时间

### 3. 故障排除
- **设置丢失**：检查是否启用了自动保存功能
- **日志过多**：启用自动清理或手动清理日志目录
- **路径错误**：使用默认按钮重置到应用程序目录

## 文件结构
```
680update_software/
├── mainwindow.h/.cpp      # 主窗口（增强设置集成）
├── settingsdialog.h/.cpp  # 设置对话框（完整功能）
├── main.qss               # 样式表（美化设计）
├── QtProject.pro          # 项目文件
├── build_complete_settings.bat  # 构建脚本
└── 完整设置功能说明.md    # 本文档
```

## 版本历史
- **v1.0**: 基础文件传输功能
- **v1.1**: 添加远程命令执行
- **v1.2**: 实现设置对话框
- **v1.3**: 完善应用设置管理（当前版本）

## 技术特点
- **现代化设计**：使用QSS样式表实现专业界面
- **智能化管理**：自动保存、智能路径、定时清理
- **高度可配置**：所有关键参数都可用户自定义
- **向后兼容**：保持与旧版本设置的兼容性
- **错误处理**：完善的输入验证和异常处理机制

## 构建说明
运行 `build_complete_settings.bat` 即可自动构建项目，脚本会：
1. 检查Qt环境和必要文件
2. 清理旧的构建文件
3. 生成Makefile并编译
4. 复制必要文件到输出目录
5. 自动启动编译后的程序

编译成功后即可享受完整的设置管理功能！ 